# راهنمای فیلتر‌های محصولات (Products Filters Guide)

## فیلترها و ویژگی‌های پیشرفته

سیستم فیلتری جامع برای محصولات با امکانات عمومی سایت‌های فروشگاهی اضافه شده است.

---

## پارامترهای جستجو و فیلتری

### 1. **جستجو و نام (Search)**
- **پارامتر**: `search`
- **نوع**: string
- **توضیح**: جستجو در نام محصول و توضیحات آن
- **مثال**: `/products?search=گوشی`

### 2. **کد محصول (SKU)**
- **پارامتر**: `sku`
- **نوع**: string
- **توضیح**: جستجو در کد عددی/کدی محصول
- **مثال**: `/products?sku=PHONE001`

---

## فیلتر‌های دسته‌بندی

### 3. **دسته‌بندی (Category)**
- **پارامتر**: `categoryId`
- **نوع**: number
- **توضیح**: نمایش محصولات یک دسته (شامل تمامی دسته‌های فرزند)
- **مثال**: `/products?categoryId=5`

### 4. **تگ‌ها (Tags)**
- **پارامتر**: `tagIds`
- **نوع**: string (comma-separated)
- **توضیح**: فیلتر بر اساس یک یا چند تگ (تگ‌ها را با کاما جدا کنید)
- **مثال**: `/products?tagIds=1,2,3`

---

## فیلتر‌های قیمتی

### 5. **حداقل قیمت (Minimum Price)**
- **پارامتر**: `minPrice`
- **نوع**: number
- **توضیح**: نمایش محصولات با قیمت بالاتر یا مساوی مقدار مشخص شده
- **مثال**: `/products?minPrice=100000`

### 6. **حداکثر قیمت (Maximum Price)**
- **پارامتر**: `maxPrice`
- **نوع**: number
- **توضیح**: نمایش محصولات با قیمت کمتر یا مساوی مقدار مشخص شده
- **مثال**: `/products?maxPrice=500000`

### 7. **بازه قیمتی (Price Range)**
- **مثال**: `/products?minPrice=100000&maxPrice=500000`
- **نوت**: قیمت بر اساس `discountPrice` اگر موجود باشد، وگرنه `price` استفاده می‌شود

---

## فیلتر‌های موجودی و تخفیف

### 8. **فقط محصولات موجود (In Stock Only)**
- **پارامتر**: `inStockOnly`
- **نوع**: boolean
- **مقادیر**: `true` یا `false`
- **توضیح**: نمایش فقط محصولاتی که موجود در انبار هستند
- **مثال**: `/products?inStockOnly=true`

### 9. **فقط محصولات تخفیف‌دار (Discounted Only)**
- **پارامتر**: `discountedOnly`
- **نوع**: boolean
- **مقادیر**: `true` یا `false`
- **توضیح**: نمایش فقط محصولاتی که تخفیف دارند
- **مثال**: `/products?discountedOnly=true`

### 10. **فقط محصولات دارای گارانتی (Warranty Only)**
- **پارامتر**: `hasWarrantyOnly`
- **نوع**: boolean
- **مقادیر**: `true` یا `false`
- **توضیح**: نمایش فقط محصولاتی که دارای گارانتی هستند
- **مثال**: `/products?hasWarrantyOnly=true`

---

## فیلتر فروشنده

### 11. **فروشنده (Seller)**
- **پارامتر**: `sellerIds`
- **نوع**: string (comma-separated)
- **توضیح**: نمایش محصولات از فروشندگان مشخص شده
- **مثال**: `/products?sellerIds=1,2,3`

---

## ترتیب و مرتب‌سازی

### 12. **نحوه ترتیب (Sort By)**
- **پارامتر**: `sortBy`
- **نوع**: enum
- **مقادیر ممکن**:
  - `newest` - جدیدترین محصولات (پیش‌فرض)
  - `price_low` - ارزان‌ترین قیمت
  - `price_high` - گران‌ترین قیمت
  - `popular` - پرفروش‌ترین (بر اساس تعداد فروشندگان)
  - `rating` - بهترین امتیاز
  - `discount` - بیشترین درصد تخفیف

**مثال‌ها**:
- `/products?sortBy=price_low` - ارزان‌ترین محصولات
- `/products?sortBy=discount` - محصولات با بیشترین تخفیف
- `/products?sortBy=newest` - جدیدترین محصولات

---

## صفحه‌بندی

### 13. **شماره صفحه (Page)**
- **پارامتر**: `page`
- **نوع**: number
- **پیش‌فرض**: 1
- **مثال**: `/products?page=2`

### 14. **تعداد اقلام در صفحه (Limit)**
- **پارامتر**: `limit`
- **نوع**: number
- **پیش‌فرض**: 10
- **مثال**: `/products?limit=20`

---

## وضعیت محصول

### 15. **فعال/غیرفعال (Active Status)**
- **پارامتر**: `isActive`
- **نوع**: boolean
- **مقادیر**: `true` یا `false`
- **پیش‌فرض**: `true` (فقط محصولات فعال)
- **توضیح**: فیلتر بر اساس وضعیت فعال/غیرفعال بودن محصول
- **مثال**: `/products?isActive=true`

---

## مثال‌های کاربردی

### مثال 1: محصولات ارزان قیمت یک دسته
```
GET /products?categoryId=5&sortBy=price_low&limit=20
```
نمایش 20 محصول از دسته 5 مرتب شده از ارزان‌ترین

### مثال 2: محصولات موجود با تخفیف
```
GET /products?inStockOnly=true&discountedOnly=true&sortBy=discount
```
نمایش محصولات موجود در انبار که تخفیف دارند، مرتب شده بر اساس درصد تخفیف

### مثال 3: جستجو با بازه قیمت
```
GET /products?search=گوشی&minPrice=50000&maxPrice=200000&page=1&limit=15
```
جستجو برای "گوشی" در بازه قیمتی 50000 تا 200000، صفحه 1 با 15 نتیجه

### مثال 4: محصولات برند خاص (استفاده از تگ)
```
GET /products?tagIds=2,3&sellerIds=1&sortBy=rating
```
نمایش محصولات با تگ‌های 2 و 3 از فروشنده 1، مرتب شده بر اساس امتیاز

### مثال 5: محصولات جدید با گارانتی
```
GET /products?hasWarrantyOnly=true&sortBy=newest
```
نمایش محصولات جدید که دارای گارانتی هستند

---

## پاسخ API

هر درخواست فیلتری پاسخی به این فرمت می‌دهد:

```json
{
  "data": [...محصولات],
  "total": 50,
  "page": 1,
  "limit": 10,
  "totalPages": 5,
  "minPrice": 10000,
  "maxPrice": 500000
}
```

- **data**: آرایه محصولات یافت شده
- **total**: کل تعداد محصولات
- **page**: شماره صفحه فعلی
- **limit**: تعداد نتایج در هر صفحه
- **totalPages**: کل تعداد صفحات
- **minPrice**: کمترین قیمت دسترس‌پذیر
- **maxPrice**: بیشترین قیمت دسترس‌پذیر

---

## نکات مهم

1. **ترکیب فیلتر‌ها**: می‌توانید بیشتر از یک فیلتر را با هم ترکیب کنید
2. **قیمت‌گذاری**: قیمت‌های محصولات از `SellerOffer` گرفته می‌شوند
3. **موجودی**: محصول فقط درصورتی موجود محسوب می‌شود که حداقل یک `offer` با `stock > 0` داشته باشد
4. **تخفیف**: تخفیف از فیلد `discountPercent` در `SellerOffer` محاسبه می‌شود
5. **دسته‌بندی سلسله‌مراتبی**: فیلتر دسته‌بندی شامل تمامی دسته‌های فرزند است

---

## تحسین‌های آینده ممکن

- [ ] رتینگ مشتریان/نظرات برای هر محصول
- [ ] فیلتر بر اساس مشخصات محصول
- [ ] فیلتر بر اساس برند
- [ ] فیلتر بر اساس رنگ/سایز (بر اساس variant values)
- [ ] فیلتر بر اساس قابلیت بازگشتی
- [ ] فیلتر بر اساس زمان تحویل
